#!/usr/bin/env python3
"""
üîê SIMPLE SECURITY CHECKER - –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Windows
–ó–∞–ø—É—Å–∫: python security_checker_simple.py
"""

import os
import platform
import subprocess
import json
from datetime import datetime


class Colors:
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    BLUE = '\033[94m'
    END = '\033[0m'


def run_cmd(cmd):
    """–í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π"""
    try:
        result = subprocess.run(
            cmd,
            shell=True,
            capture_output=True,
            text=True,
            encoding='cp866',  # –†—É—Å—Å–∫–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –¥–ª—è Windows
            timeout=10
        )
        return result.stdout.strip()
    except:
        return ""


def check_antivirus():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–Ω—Ç–∏–≤–∏—Ä—É—Å"""
    print(f"\n{Colors.BLUE}[1] –ê–ù–¢–ò–í–ò–†–£–°:{Colors.END}")

    # –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ WMIC
    output = run_cmd('WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName')

    if output and "displayName" not in output:
        lines = [line.strip() for line in output.split('\n') if line.strip()]
        for line in lines:
            if line and "displayName" not in line:
                print(f"{Colors.GREEN}‚úÖ –ù–∞–π–¥–µ–Ω: {line}{Colors.END}")
        return True
    else:
        # –°–ø–æ—Å–æ–± 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É–∂–±—ã Windows Defender
        output = run_cmd('sc query WinDefend')
        if "RUNNING" in output:
            print(f"{Colors.GREEN}‚úÖ Windows Defender –∑–∞–ø—É—â–µ–Ω{Colors.END}")
            return True

    print(f"{Colors.RED}‚ùå –ê–Ω—Ç–∏–≤–∏—Ä—É—Å –Ω–µ –Ω–∞–π–¥–µ–Ω!{Colors.END}")
    return False


def check_firewall():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä"""
    print(f"\n{Colors.BLUE}[2] –ë–†–ê–ù–î–ú–ê–£–≠–†:{Colors.END}")

    output = run_cmd('netsh advfirewall show allprofiles')

    if "State ON" in output:
        print(f"{Colors.GREEN}‚úÖ –§–∞–µ—Ä–≤–æ–ª –≤–∫–ª—é—á–µ–Ω{Colors.END}")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        if "BlockInbound" in output:
            print(f"{Colors.GREEN}  ‚Ä¢ –í—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è{Colors.END}")
        else:
            print(f"{Colors.YELLOW}  ‚ö† –í—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã{Colors.END}")

        return True
    else:
        print(f"{Colors.RED}‚ùå –§–∞–µ—Ä–≤–æ–ª –æ—Ç–∫–ª—é—á–µ–Ω!{Colors.END}")
        return False


def check_updates():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
    print(f"\n{Colors.BLUE}[3] –û–ë–ù–û–í–õ–ï–ù–ò–Ø WINDOWS:{Colors.END}")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã
    output = run_cmd('systeminfo | findstr /B /C:"–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã"')

    if output:
        print(f"{Colors.GREEN}‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞{Colors.END}")
        print(f"  ‚Ä¢ {output}")
    else:
        print(f"{Colors.YELLOW}‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å{Colors.END}")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª—É–∂–±—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
    output = run_cmd('sc query wuauserv')
    if "RUNNING" in output:
        print(f"{Colors.GREEN}‚úÖ –°–ª—É–∂–±–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞–ø—É—â–µ–Ω–∞{Colors.END}")
    else:
        print(f"{Colors.YELLOW}‚ö† –°–ª—É–∂–±–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞{Colors.END}")

    return True


def check_users():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    print(f"\n{Colors.BLUE}[4] –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò:{Colors.END}")

    output = run_cmd('net user')

    if output:
        users = [line.strip() for line in output.split('\n')
                 if line.strip() and not '---' in line and '—É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏' not in line.lower()]

        print(f"{Colors.GREEN}‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(users)}{Colors.END}")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
        output_admins = run_cmd('net localgroup administrators')
        if output_admins:
            admins = [line.strip() for line in output_admins.split('\n')
                      if line.strip() and not '---' in line
                      and '–∫–æ–º–∞–Ω–¥–∞' not in line.lower()
                      and 'administrators' not in line]

            print(f"  ‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {len(admins)}")
            if len(admins) > 3:
                print(f"{Colors.YELLOW}  ‚ö† –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤!{Colors.END}")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Å—Ç–µ–≤—É—é —É—á–µ—Ç–∫—É
        if "–ì–æ—Å—Ç—å" in output or "Guest" in output:
            print(f"{Colors.YELLOW}  ‚ö† –ì–æ—Å—Ç–µ–≤–∞—è —É—á–µ—Ç–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞{Colors.END}")

    return True


def check_rdp():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É–¥–∞–ª–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø"""
    print(f"\n{Colors.BLUE}[5] –£–î–ê–õ–ï–ù–ù–´–ô –î–û–°–¢–£–ü (RDP):{Colors.END}")

    output = run_cmd('reg query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server" /v fDenyTSConnections')

    if "0x0" in output:
        print(f"{Colors.RED}‚ùå RDP –í–ö–õ–Æ–ß–ï–ù! –≠—Ç–æ –æ–ø–∞—Å–Ω–æ!{Colors.END}")
        return False
    elif "0x1" in output:
        print(f"{Colors.GREEN}‚úÖ RDP –æ—Ç–∫–ª—é—á–µ–Ω (—Ö–æ—Ä–æ—à–æ){Colors.END}")
        return True
    else:
        print(f"{Colors.YELLOW}‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å RDP{Colors.END}")
        return True


def check_uac():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç UAC (–ö–æ–Ω—Ç—Ä–æ–ª—å —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π)"""
    print(f"\n{Colors.BLUE}[6] –ö–û–ù–¢–†–û–õ–¨ –£–ß–ï–¢–ù–´–• –ó–ê–ü–ò–°–ï–ô (UAC):{Colors.END}")

    output = run_cmd('reg query "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System" /v EnableLUA')

    if "0x1" in output:
        print(f"{Colors.GREEN}‚úÖ UAC –≤–∫–ª—é—á–µ–Ω{Colors.END}")
        return True
    else:
        print(f"{Colors.RED}‚ùå UAC –æ—Ç–∫–ª—é—á–µ–Ω! –í–∫–ª—é—á–∏—Ç–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏{Colors.END}")
        return False


def check_autostart():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É"""
    print(f"\n{Colors.BLUE}[7] –ê–í–¢–û–ó–ê–ì–†–£–ó–ö–ê:{Colors.END}")

    # –ü–∞–ø–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    startup_path = os.path.join(os.getenv('APPDATA'),
                                'Microsoft', 'Windows', 'Start Menu',
                                'Programs', 'Startup')

    if os.path.exists(startup_path):
        files = os.listdir(startup_path)
        if files:
            print(f"{Colors.YELLOW}‚ö† –í –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–µ {len(files)} —Ñ–∞–π–ª–æ–≤:{Colors.END}")
            for file in files[:3]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3
                print(f"  ‚Ä¢ {file}")
            if len(files) > 5:
                print(f"{Colors.YELLOW}  ‚ö† –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–µ!{Colors.END}")
        else:
            print(f"{Colors.GREEN}‚úÖ –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—É—Å—Ç–∞ (—Ö–æ—Ä–æ—à–æ){Colors.END}")
    else:
        print(f"{Colors.GREEN}‚úÖ –ü–∞–ø–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞{Colors.END}")

    return True


def check_shared():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—â–∏–µ –ø–∞–ø–∫–∏"""
    print(f"\n{Colors.BLUE}[8] –û–ë–©–ò–ï –ü–ê–ü–ö–ò:{Colors.END}")

    output = run_cmd('net share')

    if output and "–ò–º—è —Ä–µ—Å—É—Ä—Å–∞" not in output:
        shares = [line.split()[0] for line in output.split('\n')
                  if line.strip() and '–ò–º—è —Ä–µ—Å—É—Ä—Å–∞' not in line
                  and '---' not in line]

        # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞—Ä—ã
        system_shares = ['ADMIN$', 'C$', 'IPC$', 'print$']
        user_shares = [s for s in shares if s not in system_shares]

        if user_shares:
            print(f"{Colors.YELLOW}‚ö† –ù–∞–π–¥–µ–Ω—ã –æ–±—â–∏–µ –ø–∞–ø–∫–∏:{Colors.END}")
            for share in user_shares:
                print(f"  ‚Ä¢ {share}")
        else:
            print(f"{Colors.GREEN}‚úÖ –õ–∏—à–Ω–∏—Ö –æ–±—â–∏—Ö –ø–∞–ø–æ–∫ –Ω–µ—Ç{Colors.END}")
    else:
        print(f"{Colors.GREEN}‚úÖ –û–±—â–∏—Ö –ø–∞–ø–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ{Colors.END}")

    return len(user_shares) == 0


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("=" * 70)
    print("üîê SECURITY CHECKER - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Windows")
    print("=" * 70)

    if platform.system() != "Windows":
        print(f"{Colors.RED}‚ùå –≠—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è Windows!{Colors.END}")
        return

    results = []

    # –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏
    results.append(check_antivirus())
    results.append(check_firewall())
    results.append(check_updates())
    results.append(check_users())
    results.append(check_rdp())
    results.append(check_uac())
    results.append(check_autostart())
    results.append(check_shared())

    # –ò—Ç–æ–≥–∏
    print("\n" + "=" * 70)
    print(f"{Colors.BLUE}üìä –ò–¢–û–ì–ò –ü–†–û–í–ï–†–ö–ò:{Colors.END}")

    passed = sum(results)
    total = len(results)
    score = int((passed / total) * 100) if total > 0 else 0

    print(f"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫: {total}")
    print(f"–ü—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ: {passed}")
    print(f"–£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: {score}%")

    if score >= 80:
        print(f"{Colors.GREEN}‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!{Colors.END}")
    elif score >= 60:
        print(f"{Colors.YELLOW}‚ö† –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å{Colors.END}")
    else:
        print(f"{Colors.Red}‚ùå –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!{Colors.END}")

    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    print(f"\n{Colors.BLUE}üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:{Colors.END}")
    print("1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç")
    print("2. –í–∫–ª—é—á–∏—Ç–µ —Ñ–∞–µ—Ä–≤–æ–ª –∏ UAC")
    print("3. –û—Ç–∫–ª—é—á–∏—Ç–µ RDP –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ")
    print("4. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É –Ω–∞ –≤–∏—Ä—É—Å—ã")
    print("5. –ó–∞–∫—Ä–æ–π—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –æ–±—â–∏–µ –ø–∞–ø–∫–∏")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç
    report = {
        "date": datetime.now().isoformat(),
        "os": platform.system(),
        "version": platform.version(),
        "score": score,
        "passed": passed,
        "total": total
    }

    with open("security_report.json", "w", encoding="utf-8") as f:
        json.dump(report, f, indent=2, ensure_ascii=False)

    print(f"\n{Colors.GREEN}üìÑ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ security_report.json{Colors.END}")
    print("=" * 70)


if __name__ == "__main__":
    main()
